"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[491],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(n),h=i,m=d["".concat(l,".").concat(h)]||d[h]||c[h]||r;return n?o.createElement(m,a(a({ref:t},u),{},{components:n})):o.createElement(m,a({ref:t},u))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,a=new Array(r);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var p=2;p<r;p++)a[p]=n[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2440:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var o=n(7462),i=(n(7294),n(3905));const r={id:"networking",title:"Networking"},a=void 0,s={unversionedId:"start/smesher/networking",id:"start/smesher/networking",title:"Networking",description:"Most miners should never need to think much about their network settings. The Spacemesh node software ships with a reasonable default set of parameters that should work well for most node operators and most miners, and the software is built on top of the popular libp2p network stack which includes many useful features and support for things like peer discovery and NAT traversal.",source:"@site/docs/start/smesher/networking.md",sourceDirName:"start/smesher",slug:"/start/smesher/networking",permalink:"/docs/start/smesher/networking",draft:!1,tags:[],version:"current",frontMatter:{id:"networking",title:"Networking"},sidebar:"start",previous:{title:"PoET Servers",permalink:"/docs/start/smesher/poet"},next:{title:"Fine-Tuning Node Performance",permalink:"/docs/start/smesher/performance"}},l={},p=[{value:"NAT Traversal",id:"nat-traversal",level:3},{value:"Number of Connections",id:"number-of-connections",level:3},{value:"Private Nodes",id:"private-nodes",level:3},{value:"Performance optimizations while running public-private nodes setup",id:"performance-optimizations-while-running-public-private-nodes-setup",level:4},{value:"Disabling verifying POST on private nodes",id:"disabling-verifying-post-on-private-nodes",level:5},{value:"Changing k3 parameter",id:"changing-k3-parameter",level:5},{value:"RandomX Fast mode",id:"randomx-fast-mode",level:5}],u={toc:p};function c(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Most miners should never need to think much about their network settings. The Spacemesh node software ships with a reasonable default set of parameters that should work well for most node operators and most miners, and the software is built on top of the popular ",(0,i.kt)("a",{parentName:"p",href:"https://libp2p.io/"},"libp2p network stack")," which includes many useful features and support for things like peer discovery and NAT traversal."),(0,i.kt)("h3",{id:"nat-traversal"},"NAT Traversal"),(0,i.kt)("p",null,"When the node boots up, by default it tries to ",(0,i.kt)("a",{parentName:"p",href:"https://docs.libp2p.io/concepts/nat/overview/#automatic-router-configuration"},"automatically configure an open port"),' that will allow it to listen for inbound connections. While this isn\'t strictly required for participation in the network, it\'s strongly encouraged, since without an open inbound port your node will not be "routable" or "dialable", meaning it can only establish outbound connections (but not accept inbound ones). This damages the health of the entire p2p network. Note that, in addition to this feature, if you have a firewall running either locally or on your router, you\'ll need to manually open the "listen" port, which is 7513 by default. Firewall configurations vary from system to system; see ',(0,i.kt)("a",{parentName:"p",href:"/docs/start/netconfig"},"Network configuration")," for more information."),(0,i.kt)("p",null,"You can disable NAT traversal with the ",(0,i.kt)("inlineCode",{parentName:"p"},"--disable-natport")," commandline flag or config variable, and you can configure a different listen port using ",(0,i.kt)("inlineCode",{parentName:"p"},"--listen"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'> go-spacemesh -h\n...\n      --listen string                                 address for listening (default "/ip4/0.0.0.0/tcp/7513")\n      --disable-natport                               disable nat port-mapping (if enabled upnp protocol is used to negotiate external port with router)\n')),(0,i.kt)("h3",{id:"number-of-connections"},"Number of Connections"),(0,i.kt)("p",null,"By default the node attempts to maintain 20-100 peer connections, including both inbound and outbound. The number of inbound and outbound connections is governed by the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/spacemeshos/go-spacemesh/blob/475b05b6a8900424bedf5b9086881920ed035b8b/p2p/host.go#L75-L106"},"p2p config"),". Miners wishing to manage the details of their node's participation in the p2p network may wish to tweak the following settings:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"listen"),": as mentioned above, this is the inbound connection port"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"disable-natport")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"p2p-holepunching"),": as mentioned above, these features can be used for NAT traversal. See ",(0,i.kt)("a",{parentName:"li",href:"https://docs.libp2p.io/concepts/nat/overview/"},"What are NATs")," for more information."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"min-peers"),": when the node is connected to fewer than this number of peers, the discovery process will continue to run to find new peers to connect to"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"low-peers")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"high-peers"),": when the number of peer connections exceeds ",(0,i.kt)("inlineCode",{parentName:"li"},"high-peers"),", connections will be pruned until the number falls to ",(0,i.kt)("inlineCode",{parentName:"li"},"low-peers")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"inbound-fraction"),": the node will not allow more than ",(0,i.kt)("inlineCode",{parentName:"li"},"inbound-fraction x high-peers")," inbound connections at any given time."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"outbound-fraction"),": the node will not allow more than ",(0,i.kt)("inlineCode",{parentName:"li"},"outbound-fraction x high-peers")," outbound connections at any given time."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"direct")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"bootnodes"),": can be used to manage public and private nodes; see next section.")),(0,i.kt)("p",null,"As usual, any of these settings may be passed as commandline flags to ",(0,i.kt)("inlineCode",{parentName:"p"},"go-spacemesh"),", or may be included in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/spacemeshos/wiki/wiki/Smesher-Guide#config"},"config file"),"."),(0,i.kt)("p",null,"Even more settings are available. See the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/spacemeshos/go-spacemesh/blob/475b05b6a8900424bedf5b9086881920ed035b8b/p2p/host.go#L75-L106"},"p2p config")," and ",(0,i.kt)("a",{parentName:"p",href:"https://docs.libp2p.io/"},"the libp2p docs")," for more information."),(0,i.kt)("h3",{id:"private-nodes"},"Private Nodes"),(0,i.kt)("p",null,"A miner running ",(0,i.kt)("a",{parentName:"p",href:"#multiple-nodes"},"multiple nodes")," or ",(0,i.kt)("a",{parentName:"p",href:"#identity-management"},"multiple identities"),' may wish to manually configure how the nodes peer with and communicate with one another. In other words, miners can configure a custom network topology among their own nodes. One very common configuration is to have one or more public "gateway" nodes that are publicly accessible and responsible for communicating with the outside world that relay information from the public p2p network to many private nodes. Such a configuration can save an enormous amount of bandwidth compared to each of several nodes joining the public p2p network directly.'),(0,i.kt)("p",null,"Such a configuration is achieved through the use of the ",(0,i.kt)("inlineCode",{parentName:"p"},"bootnodes")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"direct")," parameters in the ",(0,i.kt)("inlineCode",{parentName:"p"},"p2p")," config. The process is fully documented in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/spacemeshos/go-spacemesh/blob/develop/p2p/README.md"},"go-spacemesh p2p README"),"."),(0,i.kt)("h4",{id:"performance-optimizations-while-running-public-private-nodes-setup"},"Performance optimizations while running public-private nodes setup"),(0,i.kt)("p",null,"If you're running a public-private nodes setup, you may wish to tweak the following settings to improve the CPU resource usage of your ",(0,i.kt)("strong",{parentName:"p"},"private")," nodes."),(0,i.kt)("h5",{id:"disabling-verifying-post-on-private-nodes"},"Disabling verifying POST on private nodes"),(0,i.kt)("p",null,"Verification of POST proofs in ATX that come from the network is significantly hard work for the CPU. In a setup where only some nodes are public, it makes no sense to repeat this work on the private nodes if they can trust the public nodes to do the work honestly."),(0,i.kt)("p",null,"Post verification can be disabled completely on selected nodes by using ",(0,i.kt)("inlineCode",{parentName:"p"},"--smeshing-opts-verifying-disable")," CLI flag or the following config entry:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "smeshing": {\n    "smeshing-verifying-opts": {\n      "smeshing-opts-verifying-disable": true\n    }\n}\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"[!WARNING]","\nUsing this is safe ",(0,i.kt)("strong",{parentName:"p"},"only on the private")," nodes because the ",(0,i.kt)("strong",{parentName:"p"},"public")," node will verify ATXs for it. Given that the private nodes are only connected to public nodes, there is no risk involved here. It is strongly ",(0,i.kt)("strong",{parentName:"p"},"discouraged")," to use this setting on ",(0,i.kt)("strong",{parentName:"p"},"public")," nodes.")),(0,i.kt)("h5",{id:"changing-k3-parameter"},"Changing k3 parameter"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'  "post": {\n    "post-k3": 0\n  }\n')),(0,i.kt)("p",null,"It will significantly lower the CPU requirements while verifying the incoming ATXs."),(0,i.kt)("p",null,"By default ",(0,i.kt)("inlineCode",{parentName:"p"},"k3")," parameter is equal to ",(0,i.kt)("inlineCode",{parentName:"p"},"k2")," which is currently 37. Setting it to a lower value than 37 will check fewer labels in the proofs and therefore speed up the checks. The downside is that it will lower the security of the ATX verification. The lower the value the lower the security. Setting it to 0 will disable the proof labels verification completely. The node will still verify the k2pow with RandomX though."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"[!WARNING]","\nSetting k3 to 0 is safe to use on ",(0,i.kt)("strong",{parentName:"p"},"only on the private")," nodes because the ",(0,i.kt)("strong",{parentName:"p"},"public")," node will verify whole proofs and not just one label as set in the config above. And given that the private nodes are only connected to public nodes then there is no risk involved here. It is strongly ",(0,i.kt)("strong",{parentName:"p"},"discouraged")," to use this setting on ",(0,i.kt)("strong",{parentName:"p"},"public")," nodes.")),(0,i.kt)("h5",{id:"randomx-fast-mode"},"RandomX Fast mode"),(0,i.kt)("p",null,"To improve ATX verification speed on ",(0,i.kt)("strong",{parentName:"p"},"public")," nodes you can use the following setting. It will require roughly additional 2GB of RAM per node used only during ATX verification."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'  "smeshing": {\n    "smeshing-verifying-opts": {\n    "smeshing-opts-verifying-powflags": 14\n    }\n  }\n')),(0,i.kt)("p",null,"If you have spare ram on the private nodes then that setting is safe to set there too. Please remember about the requirement of 2GiB extra memory per node though."))}c.isMDXComponent=!0}}]);