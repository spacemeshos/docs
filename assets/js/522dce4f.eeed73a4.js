"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5790],{5680:(e,t,a)=>{a.d(t,{xA:()=>p,yg:()=>g});var s=a(6540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function n(e,t){if(null==e)return{};var a,s,r=function(e,t){if(null==e)return{};var a,s,r={},o=Object.keys(e);for(s=0;s<o.length;s++)a=o[s],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)a=o[s],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=s.createContext({}),h=function(e){var t=s.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=h(e.components);return s.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},m=s.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=n(e,["components","mdxType","originalType","parentName"]),c=h(a),m=r,g=c["".concat(l,".").concat(m)]||c[m]||d[m]||o;return a?s.createElement(g,i(i({ref:t},p),{},{components:a})):s.createElement(g,i({ref:t},p))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var n={};for(var l in t)hasOwnProperty.call(t,l)&&(n[l]=t[l]);n.originalType=e,n[c]="string"==typeof e?e:r,i[1]=n;for(var h=2;h<o;h++)i[h]=a[h];return s.createElement.apply(null,i)}return s.createElement.apply(null,a)}m.displayName="MDXCreateElement"},5013:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>h});var s=a(8168),r=(a(6540),a(5680));const o={id:"rewards",title:"How Rewards Work"},i=void 0,n={unversionedId:"start/rewards",id:"start/rewards",title:"How Rewards Work",description:"In Spacemesh, smeshers earn rewards for successfully proving eligibility and submitting valid block proposals to the network during their designated eligibility slots. Note that, at present, the only behavior that is rewarded is the submission of block proposals. However, in the future, we intend to additionally incentivize other useful behavior such as participating in the Hare consensus.",source:"@site/docs/start/rewards.md",sourceDirName:"start",slug:"/start/rewards",permalink:"/docs/start/rewards",draft:!1,editUrl:"https://github.com/spacemeshos/docs/edit/main/docs/start/rewards.md",tags:[],version:"current",frontMatter:{id:"rewards",title:"How Rewards Work"},sidebar:"start",previous:{title:"Troubleshooting",permalink:"/docs/start/smeshing/smeshing_adv/troubleshooting"},next:{title:"Integration Guide",permalink:"/docs/start/integration"}},l={},h=[{value:"Estimated Rewards",id:"estimated-rewards",level:2},{value:"Eligibility Slots",id:"eligibility-slots",level:2},{value:"Earned Rewards",id:"earned-rewards",level:2},{value:"Missed Rewards",id:"missed-rewards",level:2},{value:"Reward Lifecycle",id:"reward-lifecycle",level:2},{value:"Further Reading",id:"further-reading",level:2}],p={toc:h},c="wrapper";function d(e){let{components:t,...a}=e;return(0,r.yg)(c,(0,s.A)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"In Spacemesh, smeshers earn rewards for successfully proving eligibility and submitting valid block proposals to the network during their designated eligibility slots. Note that, at present, the only behavior that is rewarded is the submission of block proposals. However, in the future, we intend to additionally incentivize other useful behavior such as participating in the Hare consensus."),(0,r.yg)("p",null,"As with many other blockchain networks, rewards consist of two components:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Block subsidy")," (i.e., coins newly minted by the protocol)"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Transaction fees"))),(0,r.yg)("p",null,"While we expect transaction fees to increase and form a larger percentage of rewards over time, at this early stage in the network lifecycle, the vast majority of rewards (more than 99.99%) comes from block subsidies. As such, the remainder of this analysis will ignore transaction fees for the purpose of estimating rewards."),(0,r.yg)("h2",{id:"estimated-rewards"},"Estimated Rewards"),(0,r.yg)("p",null,"Three factors are necessary to calculate a smesher's estimated rewards:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"The smesher's ",(0,r.yg)("strong",{parentName:"li"},"weight")," in a given ",(0,r.yg)("a",{parentName:"li",href:"/docs/start/integration#time"},"epoch")),(0,r.yg)("li",{parentName:"ul"},"The ",(0,r.yg)("strong",{parentName:"li"},"total network ","[weight]")," in the epoch"),(0,r.yg)("li",{parentName:"ul"},"The ",(0,r.yg)("strong",{parentName:"li"},"per-layer subsidy."))),(0,r.yg)("p",null,"A smesher's ",(0,r.yg)("a",{parentName:"p",href:"/docs/learn/atx#we"},"weight")," in a given epoch (as encoded in the ",(0,r.yg)("a",{parentName:"p",href:"/docs/learn/atx"},"ATX")," they submitted to establish ","[eligibility]"," for the epoch) is simply the number of space units (SUs) allocated times the number of PoET ticks. For instance, a smesher with 4 SU (the minimum) and a PoET proof with 100k ticks would have a weight of 400k."),(0,r.yg)("p",null,"The total network weight is (as the name suggests) the weight of ",(0,r.yg)("em",{parentName:"p"},"all")," eligible smeshers in the same epoch. A smesher's ",(0,r.yg)("strong",{parentName:"p"},"relative weight")," is the weight of their ATX in a given epoch divided by the total network weight in that epoch. Currently, there is not any easy way to retrieve total network weight, but given that at present nearly all smeshers are using the same ",(0,r.yg)("a",{parentName:"p",href:"/docs/learn/poet"},"PoET")," proof or a PoET proof with a similar number of ticks, it can be estimated by dividing the smesher's total committed storage by the total network storage (as displayed on the ",(0,r.yg)("a",{parentName:"p",href:"https://dash.spacemesh.io/"},"Network Dashboard"),"). For instance, a smesher with 1TiB of storage of a network that's 18 PiB has 1/18000 = 5.6",(0,r.yg)("sup",null,"-5")," of the total network space."),(0,r.yg)("p",null,"The final piece of the puzzle is the per-layer reward. This decays gradually from layer to layer. The simplest way to see the current value is to check ",(0,r.yg)("a",{parentName:"p",href:"https://explorer.spacemesh.io/layers"},"LAYERS")," in the Explorer. As of ",(0,r.yg)("a",{parentName:"p",href:"https://explorer.spacemesh.io/layers/130271"},"layer 130271"),", 465.387 SMH are being minted as a subsidy in each layer. Multiply this by the number of layers per epoch (4032) to get the approximate total new coin issuance per epoch: for epoch 32 this is roughly 4032 * 465.387 = 1,876,440 SMH."),(0,r.yg)("p",null,"Finally, to calculate a smesher's estimated rewards for a given epoch, simply multiply the smesher's relative weight by the total epoch issuance. A smesher with 5.6",(0,r.yg)("sup",null,"-5")," of the total weight would be expected to earn around 5.6e-5*1921707 = 107 SMH in this epoch."),(0,r.yg)("p",null,"Note: It is possible to read more precise values from a node's state database (see below). This sample SQL query will give you the total weight for an epoch:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"SELECT SUM(effective_num_units*tick_count) FROM atxs WHERE epoch=2;\n781394721\n")),(0,r.yg)("p",null,"And this query will give an individual smesher's relative weight:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"SELECT 1.0*atxs.effective_num_units*atxs.tick_count/total_weight.weight\n  FROM atxs,\n       (SELECT SUM(effective_num_units*tick_count) weight FROM atxs WHERE epoch=2) AS total_weight\n  WHERE hex(atxs.id) = '1281641D519CCC57F38C38294BB873A60367DB71AD0FA8DFBD146A55FD60626C' AND atxs.epoch=2;\n0.000519591429387197\n")),(0,r.yg)("p",null,"Some smeshers may find community-run tools like ",(0,r.yg)("a",{parentName:"p",href:"https://www.spacemeshcalculator.com/"},"Spacemesh Calculator")," helpful in doing this math. However, we cannot vouch for their correctness."),(0,r.yg)("h2",{id:"eligibility-slots"},"Eligibility Slots"),(0,r.yg)("p",null,"Every eligible smesher has one or more eligibility slots per epoch during which they are eligible to produce a ",(0,r.yg)("a",{parentName:"p",href:"/docs/learn/atx#block-proposals"},"block proposal")," and thereby earn a reward. Every smesher with at least the minimum storage (4 SUs) committed is guaranteed at least one slot per epoch. There are 50 slots per layer (i.e., on average 50 proposals per layer) or 201,600 slots per epoch. The slots are assigned randomly and unpredictably at the start of the epoch so that even the smesher cannot know their own eligibility slots before the epoch starts. You can calculate the estimated number of slots for a given smesher using similar math to the above: multiply the smesher's relative epoch weight by 201,600 with ",(0,r.yg)("inlineCode",{parentName:"p"},"floor=1"),"."),(0,r.yg)("p",null,"There are several ways to see a smesher's actual eligibility slots for a given epoch. The node prints its eligibilities in the log at the beginning of an epoch. Consider the following, for example:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'2023-08-11T13:45:00.622-0400    INFO    abcde.proposalBuilder   proposal eligibility for an epoch       {"node_id": "abcde", "module": "proposalBuilder", "epoch_id": 2, "beacon": "e3e3389e", "weight": 141435, "min activeset weight": 5000000, "total weight": 305096691, "total num slots": 93, "num layers eligible": 93, "layers to num proposals": [{"layer": 8091, "slots": 1}, {"layer": 8179, "slots": 1}, {"layer": 8212, "slots": 1}, {"layer": 8215, "slots": 1}, {"layer": 8248, "slots": 1}, {"layer": 8306, "slots": 1}, {"layer": 8382, "slots": 1}, {"layer": 8389, "slots": 1}, {"layer": 8411, "slots": 1}, {"layer": 8432, "slots": 1}, {"layer": 8454, "slots": 1}...], "name": "proposalBuilder"}\n')),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"EventsStream")," API stream prints the same information:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'> grpcurl -d "{}" -plaintext localhost:9093 spacemesh.v1.AdminService.EventsStream\n...\n{\n  "timestamp": "2023-09-13T19:35:00.658169226Z",\n  "help": "Computed eligibilities for the epoch. Rewards will be received after publishing proposals at specified layers. Total amount of rewards in SMH will be based on other participants in the layer.",\n  "eligibilities": {\n    "epoch": 4,\n    "beacon": "nhiDhQ==",\n    "atx": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",\n    "activeSetSize": 16582,\n    "eligibilities": [\n      {\n        "layer": 19048,\n        "count": 1\n      },\n      {\n        "layer": 19460,\n        "count": 1\n      },\n      {\n        "layer": 18839,\n        "count": 1\n      },\n')),(0,r.yg)("p",null,"In Smapp, the same thing looks like this:"),(0,r.yg)("p",null,(0,r.yg)("img",{parentName:"p",src:"https://github.com/spacemeshos/wiki/assets/3316532/be77ccd8-ab5f-4763-8a98-8c37f606241e",alt:"image"})),(0,r.yg)("p",null,"In order to successfully earn a reward for a given eligibility slot, a smesher has to be running up-to-date software, has to be online and fully synced, and has to successfully generate and broadcast a proposal during the slot. The actual, final reward that is earned in a given slot depends upon the behavior of other eligible smeshers in the same slot. If an eligible smesher fails to submit a proposal, that smesher's portion of the reward is distributed to the eligible smeshers who were able to successfully publish proposals."),(0,r.yg)("h2",{id:"earned-rewards"},"Earned Rewards"),(0,r.yg)("p",null,"Smapp displays actual earned rewards on the SMESHING screen:"),(0,r.yg)("p",null,(0,r.yg)("img",{parentName:"p",src:"https://github.com/spacemeshos/wiki/assets/3316532/fb1ce5fa-fac5-4f36-9ef8-e22988487ce4",alt:"image"})),(0,r.yg)("p",null,"Earned rewards are also available ",(0,r.yg)("a",{parentName:"p",href:"https://explorer.spacemesh.io/accounts/sm1qqqqqqzgxd05fhulhhtqyl2s8tqsmg4wvhyvwagag395g/rewards"},"in the explorer"),". Finally, actual rewards for a given coinbase (the address to which the reward tokens are sent) address can also be fetched via the command line using the Spacemesh API:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'> grpcurl -plaintext -d "{ \\"filter\\": { \\"account_id\\": { \\"address\\": \\"sm1qqqqqqzgxd05fhulhhtqyl2s8tqsmg4wvhyvwagag395g\\" }, \\"account_data_flags\\": 2 } }" 127.0.0.1:9092 spacemesh.v1.GlobalStateService.AccountDataQuery\n{\n  "totalResults": 128,\n  "accountItem": [\n    {\n      "reward": {\n        "layer": {\n          "number": 8203\n        },\n        "total": {\n          "value": "17127640416"\n        },\n        "layerReward": {\n          "value": "17127640416"\n        },\n        "coinbase": {\n          "address": "sm1qqqqqqzgxd05fhulhhtqyl2s8tqsmg4wvhyvwagag395g"\n        }\n      }\n    },\n    {\n      "reward": {\n        "layer": {\n          "number": 8219\n        },\n        "total": {\n          "value": "14085313144"\n        },\n        "layerReward": {\n          "value": "14085307220"\n        },\n        "coinbase": {\n          "address": "sm1qqqqqqzgxd05fhulhhtqyl2s8tqsmg4wvhyvwagag395g"\n        }\n      }\n    },\n...\n')),(0,r.yg)("p",null,"You may also find this community-run ",(0,r.yg)("a",{parentName:"p",href:"http://fcmx.net/sm-eligibilities/"},"SpaceMesh Lamba Chunks"),' visual reward tracker useful. Simply copy your eligibility info from your log file (grep for "proposal eligibility for an epoch" in your log) and paste it into a Node to see a visual representation of all past eligibility slots and rewards, along with upcoming eligibility slots. It should look something like this:'),(0,r.yg)("p",null,(0,r.yg)("img",{parentName:"p",src:"https://github.com/spacemeshos/wiki/assets/3316532/3dd5d040-f65c-46ba-9b8a-d35756f10244",alt:"image"})),(0,r.yg)("h2",{id:"missed-rewards"},"Missed Rewards"),(0,r.yg)("p",null,'If your node is offline or not fully synced when an eligible slot arrives, it may fail to produce a proposal and thus miss the reward for the slot. If a proposal is produced or gossiped too late, or not received by enough other nodes in time, it may not be included in the canonical block and thus the slot reward may be missed. Note that this has no bearing whatsoever upon future eligibility slots and that the protocol does not allow a smesher to subsequently "earn back" lost rewards.'),(0,r.yg)("p",null,"In such a scenario, the coins that the smesher would have received will instead be allocated proportionally (i.e., by weight) to the other eligible smeshers that successfully produced proposals in the same slot. By far, the most common cause of missed rewards is node updates. Therefore, we strongly encourage you to closely track your eligibility slots and not restart or upgrade within 2-3 layers before an upcoming eligibility slot (so that the node has a chance to fully initialize and sync in time)."),(0,r.yg)("p",null,"There are also rare scenarios when no proposals are produced at all for a given layer (e.g., when the ",(0,r.yg)("a",{parentName:"p",href:"/docs/learn/hare"},"Hare")," mechanism fails due to a network issue such as many smeshers temporarily being offline. In these scenarios, which are usually short-lived, no proposals are produced at all, a layer will have no block and no transactions, and no rewards will be issued. In this case, the coins that would have been issued as part of the layer subsidy simply fail to get minted (i.e., they will never exist, will never enter circulation, and for all intents and purposes, may be considered burnt)."),(0,r.yg)("h2",{id:"reward-lifecycle"},"Reward Lifecycle"),(0,r.yg)("p",null,"The end-to-end reward lifecycle works as follows:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"The smeshing node performs ",(0,r.yg)("a",{parentName:"li",href:"/docs/learn/post#proof-of-space"},"Proof of Space (PoS) initialization"),"."),(0,r.yg)("li",{parentName:"ol"},"The smeshing node generates its initial ",(0,r.yg)("a",{parentName:"li",href:"/docs/learn/post#generating-the-proof"},"Proof of Space-Time (PoST)"),"."),(0,r.yg)("li",{parentName:"ol"},"The smeshing node registers with the ",(0,r.yg)("a",{parentName:"li",href:"/docs/learn/post#proof-of-elapsed-time"},"Proof of Elapsed Time (PoET) Server"),"."),(0,r.yg)("li",{parentName:"ol"},"The smeshing node receives the PoET from the PoET server and uses it to ",(0,r.yg)("a",{parentName:"li",href:"/docs/learn/post#proof-of-space-time"},"generate the PoST")," (proving that it still has the data)."),(0,r.yg)("li",{parentName:"ol"},"The smeshing node bundles the PoST into an ATX and submits it to the network to establish eligibility in the following epoch (the epoch after the upcoming one)."),(0,r.yg)("li",{parentName:"ol"},"The new epoch begins. The smeshing node calculates its eligibility slots for the epoch based on the active set (i.e., the set of all valid ATXs targeting the current epoch) and the random beacon (a random value unknown to the smesher in advance). If this step is successful, the smeshing node gets the IDs of the layers in which it can submit a block proposal."),(0,r.yg)("li",{parentName:"ol"},"The smeshing node participates in the gossip normally and follows the network, remains in sync, periodically joins a Hare committee, etc."),(0,r.yg)("li",{parentName:"ol"},"When an eligibility slot (layer) arrives, the smesher generates a block proposal based on its view of the network. The block proposal consists of all the valid transactions the node has collected into its mempool. The node signs the block proposal and broadcasts it to the rest of the network."),(0,r.yg)("li",{parentName:"ol"},"A few seconds later, the ",(0,r.yg)("a",{parentName:"li",href:"/docs/learn/hare"},"Hare protocol")," runs for the layer. A random committee of nodes is picked to come to a consensus on the canonical set of valid proposals for the layer (i.e., those received on time and with valid eligibility proofs) and they are collated into a new block. Assuming the smeshing node's proposal is valid and was received on time, it should be included in the new block."),(0,r.yg)("li",{parentName:"ol"},"A few minutes later, the new block is confirmed by the ",(0,r.yg)("a",{parentName:"li",href:"/docs/learn/tortoise"},"Tortoise protocol")," and its contents become a part of the canonical mesh. Rewards are paid to all smeshers that participated in the construction of the block by submitting valid, timely proposals.")),(0,r.yg)("p",null,'Note that the above describes the "happy" flow. Many things can happen to interfere with this process or slow it down. Proposals may not be gossiped or received on time, in which case a block still be created from the valid proposals that were received on time. If enough nodes are not online to select a Hare committee, Hare may fail, which would temporarily result in empty layers (i.e., layers without blocks), until nodes come back online and a Hare quorum can be re-established.'),(0,r.yg)("h2",{id:"further-reading"},"Further Reading"),(0,r.yg)("p",null,"For more information on rewards, prohibited behavior, and punishments, consider reading ",(0,r.yg)("a",{parentName:"p",href:"/docs/learn/rewards"},"this resource"),"."))}d.isMDXComponent=!0}}]);