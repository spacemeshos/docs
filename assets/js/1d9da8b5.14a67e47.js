"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8599],{5680:(e,n,t)=>{t.d(n,{xA:()=>l,yg:()=>m});var a=t(6540);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,s=function(e,n){if(null==e)return{};var t,a,s={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var p=a.createContext({}),c=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},l=function(e){var n=c(e.components);return a.createElement(p.Provider,{value:n},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,s=e.mdxType,r=e.originalType,p=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),h=c(t),d=s,m=h["".concat(p,".").concat(d)]||h[d]||u[d]||r;return t?a.createElement(m,i(i({ref:n},l),{},{components:t})):a.createElement(m,i({ref:n},l))}));function m(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var r=t.length,i=new Array(r);i[0]=d;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o[h]="string"==typeof e?e:s,i[1]=o;for(var c=2;c<r;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},3638:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var a=t(8168),s=(t(6540),t(5680));const r={id:"api",title:"API"},i=void 0,o={unversionedId:"guides/smeshing/smeshing_adv/api",id:"guides/smeshing/smeshing_adv/api",title:"API",description:'The node implements a gRPC API that can be used to monitor and interact with the running node, and change certain settings. The API is split into two separate instances, one public and one private, each of which implements several services that can be turned on or off at will. "Public" services provide readonly access to data such as node status, epochs/layers/blocks/transactions, account state, etc., whereas "private" services allow the operator to change the params of a running node, e.g., the smesher coinbase or the set of PoET servers. While "public" endpoints are theoretically safe to open for public API calls, in practice we strongly recommend that no API services be exposed publicly. The API design and implementation have not been hardened against denial of service attacks and represent an attack vector against a running node. For this reason, you should run both the public and private API instances on private interfaces (e.g., the loopback/127.0.0.1 interface) and/or put them behind a firewall.',source:"@site/docs/guides/smeshing/smeshing_adv/api.md",sourceDirName:"guides/smeshing/smeshing_adv",slug:"/guides/smeshing/smeshing_adv/api",permalink:"/docs/guides/smeshing/smeshing_adv/api",draft:!1,editUrl:"https://github.com/spacemeshos/docs/edit/main/docs/guides/smeshing/smeshing_adv/api.md",tags:[],version:"current",frontMatter:{id:"api",title:"API"},sidebar:"start",previous:{title:"PoST Initialization",permalink:"/docs/guides/smeshing/smeshing_adv/post_init"},next:{title:"PoET Configuration",permalink:"/docs/guides/smeshing/smeshing_adv/poet"}},p={},c=[{value:"Updates",id:"updates",level:2}],l={toc:c},h="wrapper";function u(e){let{components:n,...t}=e;return(0,s.yg)(h,(0,a.A)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,s.yg)("p",null,"The node implements a ",(0,s.yg)("a",{parentName:"p",href:"https://grpc.io/"},"gRPC"),' API that can be used to monitor and interact with the running node, and change certain settings. The API is split into two separate instances, one public and one private, each of which implements several services that can be turned on or off at will. "Public" services provide readonly access to data such as node status, epochs/layers/blocks/transactions, account state, etc., whereas "private" services allow the operator to change the params of a running node, e.g., the ',(0,s.yg)("a",{parentName:"p",href:"https://github.com/spacemeshos/api/blob/a7c0b7acd9bc72940a8ab8e22202a77a4c3f438b/spacemesh/v1/smesher.proto#L29"},"smesher coinbase")," or the ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/spacemeshos/api/blob/a7c0b7acd9bc72940a8ab8e22202a77a4c3f438b/spacemesh/v1/smesher.proto#L55"},"set of PoET servers"),'. While "public" endpoints are theoretically safe to open for public API calls, in practice ',(0,s.yg)("strong",{parentName:"p"},"we strongly recommend that no API services be exposed publicly.")," The API design and implementation have not been hardened against denial of service attacks and represent an attack vector against a running node. For this reason, you should run ",(0,s.yg)("em",{parentName:"p"},"both the public and private API instances")," on private interfaces (e.g., the loopback/127.0.0.1 interface) and/or put them behind a firewall."),(0,s.yg)("p",null,"Default network config files by default enable all API services:"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre"},'  "api": {\n    "grpc-public-services": [\n      "debug",\n      "global",\n      "mesh",\n      "node",\n      "transaction",\n      "activation"\n    ],\n    "grpc-public-listener": "0.0.0.0:9092",\n    "grpc-private-services": [\n      "smesher",\n      "admin"\n    ],\n    "grpc-private-listener": "127.0.0.1:9093",\n    "grpc-json-listener": "0.0.0.0:9094"\n  },\n')),(0,s.yg)("p",null,"Note that the public instance runs on the interface/port ",(0,s.yg)("inlineCode",{parentName:"p"},"0.0.0.0:9092")," and the private runs on ",(0,s.yg)("inlineCode",{parentName:"p"},"127.0.0.1:9093"),". ",(0,s.yg)("inlineCode",{parentName:"p"},"grpc-json-listener")," refers to a JSON-based ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/grpc-ecosystem/grpc-gateway"},"gRPC-Gateway")," that allows clients that don't speak gRPC to communicate with the API using JSON instead, and can in general be turned off."),(0,s.yg)("p",null,"The easiest way to interact with the API from the command line and from scripts is using the ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/fullstorydev/grpcurl"},(0,s.yg)("inlineCode",{parentName:"a"},"grpcurl"))," tool. gRPC is self-documenting via a feature known as ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/grpc/grpc/blob/master/doc/server-reflection.md"},"reflection")," that lets a client traverse an API, list RPC methods, inputs and outputs, and describe data types, e.g.:"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-bash"},"> grpcurl -plaintext localhost:9092 list\nspacemesh.v1.ActivationService\nspacemesh.v1.DebugService\nspacemesh.v1.GlobalStateService\nspacemesh.v1.MeshService\nspacemesh.v1.NodeService\nspacemesh.v1.TransactionService\n> grpcurl -plaintext localhost:9092 describe spacemesh.v1.NodeService\nspacemesh.v1.NodeService is a service:\nservice NodeService {\n  rpc Build ( .google.protobuf.Empty ) returns ( .spacemesh.v1.BuildResponse );\n  rpc Echo ( .spacemesh.v1.EchoRequest ) returns ( .spacemesh.v1.EchoResponse );\n  rpc ErrorStream ( .spacemesh.v1.ErrorStreamRequest ) returns ( stream .spacemesh.v1.ErrorStreamResponse );\n  rpc NodeInfo ( .google.protobuf.Empty ) returns ( .spacemesh.v1.NodeInfoResponse );\n  rpc Status ( .spacemesh.v1.StatusRequest ) returns ( .spacemesh.v1.StatusResponse );\n  rpc StatusStream ( .spacemesh.v1.StatusStreamRequest ) returns ( stream .spacemesh.v1.StatusStreamResponse );\n  rpc Version ( .google.protobuf.Empty ) returns ( .spacemesh.v1.VersionResponse );\n}\n> grpcurl -plaintext localhost:9092 describe spacemesh.v1.NodeInfoResponse\nspacemesh.v1.NodeInfoResponse is a message:\nmessage NodeInfoResponse {\n  string hrp = 1;\n  uint32 first_genesis = 2;\n  uint32 effective_genesis = 3;\n  uint32 epoch_size = 4;\n}\n")),(0,s.yg)("p",null,"For more information gRPC reflection see ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/grpc/grpc-go/blob/master/Documentation/server-reflection-tutorial.md#enable-server-reflection"},"gRPC Server Reflection Tutorial"),"."),(0,s.yg)("p",null,"Common, useful commands for node operators include:"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},"Check node status (synced layer, verified layer, number of connected peers):")),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-bash"},'> grpcurl -plaintext localhost:9092 spacemesh.v1.NodeService.Status\n{\n  "status": {\n    "connectedPeers": "31",\n    "isSynced": true,\n    "syncedLayer": {\n      "number": 16278\n    },\n    "topLayer": {\n      "number": 16278\n    },\n    "verifiedLayer": {\n      "number": 16278\n    }\n  }\n}\n')),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},"See the events stream (a useful, high level idea of what the node is doing, including PoST init, PoET registration, publishing ATXs, and publishing proposals):")),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-bash"},'> grpcurl -plaintext localhost:9093 spacemesh.v1.AdminService.EventsStream\n{\n{\n  "timestamp": "2023-09-07T17:55:22.283848702Z",\n  "help": "Node computed randomness beacon, it will be used to determine eligibility to participate in the consensus.",\n  "beacon": {\n    "epoch": 4,\n    "beacon": "nhiDhQ=="\n  }\n}\n{\n  "timestamp": "2023-09-07T17:56:23.638117180Z",\n  "help": "Node started post data initialization. Note that init is noop if node restarted when init was ready.",\n  "initStart": {\n    "smesher": "...",\n    "commitment": "..."\n  }\n}\n{\n  "timestamp": "2023-09-07T17:56:23.664434458Z",\n  "help": "Node completed post data initialization.",\n  "initComplete": {\n\n  }\n}\n{\n  "timestamp": "2023-09-07T17:56:23.686208298Z",\n  "help": "Node needs to wait for poet to complete in publish epoch. Once completed, node fetches proof from poet and runs post on that proof. After that publish an ATX that will be eligible for rewards in target epoch.",\n  "poetWaitProof": {\n    "publish": 4,\n    "target": 5,\n    "wait": "871416.313797373s"\n  }\n}\n{\n  "timestamp": "2023-09-08T08:00:01.432480745Z",\n  "help": "Computed eligibilities for the epoch. Rewards will be received after publishing proposals at specified layers. Total amount of rewards in SMH will be based on other participants in the layer.",\n  "eligibilities": {\n    "epoch": 4,\n    "beacon": "nhiDhQ==",\n    "atx": "...",\n    "activeSetSize": 16582,\n    "eligibilities": [\n      {\n        "layer": 16792,\n        "count": 1\n      },\n...\n    ]\n  }\n}\n{\n  "timestamp": "2023-09-08T12:00:00.349079938Z",\n  "help": "Published proposal. Rewards will be received, once proposal is included into the block.",\n  "proposal": {\n    "layer": 16176,\n    "proposal": "..."\n  }\n}\n\n')),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},"Retrieve account data including current balance, counter value, and rewards:")),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-bash"},'> grpcurl -plaintext -d "{ \\"filter\\": { \\"account_id\\": { \\"address\\": \\"<address>\\" }, \\"account_data_flags\\": 6 } }" 127.0.0.1:9092 spacemesh.v1.GlobalStateService.AccountDataQuery\n{\n  "totalResults": 16,\n  "accountItem": [\n    {\n      "reward": {\n        "layer": {\n          "number": 8186\n        },\n        "total": {\n          "value": "10802055452"\n        },\n        "layerReward": {\n          "value": "10802053003"\n        },\n        "coinbase": {\n          "address": "<address>"\n        }\n      }\n    },\n...\n    {\n      "accountWrapper": {\n        "accountId": {\n          "address": "<address>"\n        },\n        "stateCurrent": {\n          "counter": "1",\n          "balance": {\n            "value": "190459923001"\n          }\n        },\n        "stateProjected": {\n          "counter": "1",\n          "balance": {\n            "value": "190459923001"\n          }\n        }\n      }\n    }\n  ]\n}\n\n')),(0,s.yg)("p",null,"The Spacemesh node gRPC API lives in the ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/spacemeshos/api/"},"api repository"),"; see the ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/spacemeshos/api/tree/master/spacemesh/v1"},"service definitions"),". The implementation lives in the ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/spacemeshos/go-spacemesh/tree/develop/api/grpcserver"},(0,s.yg)("inlineCode",{parentName:"a"},"api")," directory")," of the go-spacemesh repository."),(0,s.yg)("h2",{id:"updates"},"Updates"),(0,s.yg)("p",null,"The Spacemesh team regularly releases updates to GUI and CLI node software. Smapp has a feature that monitors new releases and notifies the user when a new release is available, with a one-click update mechanism (Linux users who installed Smapp using the .deb file will need to manually check for and install updates due to ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/spacemeshos/smapp/issues/1299"},"this issue"),"). Note that, at present, go-spacemesh updates are bundled into Smapp updates, though this may change in the future; and go-spacemesh and Smapp use independent version numbering (e.g., Smapp ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/spacemeshos/smapp/releases/tag/v1.0.18"},"v1.0.18")," bundles go-spacemesh v1.0.19)."),(0,s.yg)("p",null,"No such notify or update mechanism is built into ",(0,s.yg)("inlineCode",{parentName:"p"},"go-spacemesh"),", so CLI node operators will need to manually keep their software up to date. Node updates vary in severity and, while it's generally safe to be one or two patch releases behind, this isn't always the case and some bigger updates may need to be installed right away in order to keep one's node online and mining, and in order not to receive rewards. Releases are announced on several channels including:"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://github.com/spacemeshos/go-spacemesh/releases"},"go-spacemesh releases")," on GitHub"),(0,s.yg)("li",{parentName:"ul"},"the ",(0,s.yg)("a",{parentName:"li",href:"https://discord.com/channels/623195163510046732/691258865861394432"},"#announcements channel")," on the Spacemesh Discord"),(0,s.yg)("li",{parentName:"ul"},"the official ",(0,s.yg)("a",{parentName:"li",href:"https://twitter.com/teamspacemesh"},"Spacemesh Twitter"))),(0,s.yg)("p",null,"You are strongly encouraged to watch one or more of these channels closely and/or ",(0,s.yg)("a",{parentName:"p",href:"https://docs.github.com/en/account-and-profile/managing-subscriptions-and-notifications-on-github/setting-up-notifications/configuring-notifications#configuring-your-watch-settings-for-an-individual-repository"},"subscribe to GitHub release notifications")," so that your node is up to date."))}u.isMDXComponent=!0}}]);