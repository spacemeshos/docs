"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8566],{5680:(e,t,i)=>{i.d(t,{xA:()=>c,yg:()=>m});var o=i(6540);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function s(e,t){if(null==e)return{};var i,o,n=function(e,t){if(null==e)return{};var i,o,n={},r=Object.keys(e);for(o=0;o<r.length;o++)i=r[o],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)i=r[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var l=o.createContext({}),d=function(e){var t=o.useContext(l),i=t;return e&&(i="function"==typeof e?e(t):a(a({},t),e)),i},c=function(e){var t=d(e.components);return o.createElement(l.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},f=o.forwardRef((function(e,t){var i=e.components,n=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=d(i),f=n,m=p["".concat(l,".").concat(f)]||p[f]||u[f]||r;return i?o.createElement(m,a(a({ref:t},c),{},{components:i})):o.createElement(m,a({ref:t},c))}));function m(e,t){var i=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=i.length,a=new Array(r);a[0]=f;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:n,a[1]=s;for(var d=2;d<r;d++)a[d]=i[d];return o.createElement.apply(null,a)}return o.createElement.apply(null,i)}f.displayName="MDXCreateElement"},2211:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var o=i(8168),n=(i(6540),i(5680));const r={id:"troubleshooting",title:"Troubleshooting"},a=void 0,s={unversionedId:"start/smeshing/smeshing_adv/troubleshooting",id:"start/smeshing/smeshing_adv/troubleshooting",title:"Troubleshooting",description:"Corrupt PoST Data",source:"@site/docs/start/smeshing/smeshing_adv/troubleshooting.md",sourceDirName:"start/smeshing/smeshing_adv",slug:"/start/smeshing/smeshing_adv/troubleshooting",permalink:"/docs/start/smeshing/smeshing_adv/troubleshooting",draft:!1,editUrl:"https://github.com/spacemeshos/docs/edit/main/docs/start/smeshing/smeshing_adv/troubleshooting.md",tags:[],version:"current",frontMatter:{id:"troubleshooting",title:"Troubleshooting"},sidebar:"start",previous:{title:"Initializing a Subset of PoST Data With postcli",permalink:"/docs/start/smeshing/smeshing_adv/multigpu"},next:{title:"How Rewards Work",permalink:"/docs/start/rewards"}},l={},d=[{value:"Corrupt PoST Data",id:"corrupt-post-data",level:2},{value:"Additional Troubleshooting",id:"additional-troubleshooting",level:2},{value:"<code>timesync: peers are not time synced</code>",id:"timesync-peers-are-not-time-synced",level:3},{value:"Node Uses Too Much Memory",id:"node-uses-too-much-memory",level:3}],c={toc:d},p="wrapper";function u(e){let{components:t,...i}=e;return(0,n.yg)(p,(0,o.A)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,n.yg)("h2",{id:"corrupt-post-data"},"Corrupt PoST Data"),(0,n.yg)("p",null,"One of the realities of hard drives is that, once in a while, they fail, resulting in corrupt data. Data corruption can also occur while ",(0,n.yg)("a",{parentName:"p",href:"/docs/start/smeshing/smeshing_adv/advanced#moving-post-files"},"copying or moving")," data across systems. Hopefully you will never have to deal with this situation. However, if it does happen, you will most likely find out about it when a message like the following appears in your log:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-console"},'2023-09-18T03:37:09.147-0400    INFO    abcde.nipostValidator   Found proof for nonce: 0, pow: 22517998136898104 with [96506732, 8522344264, 15809824782, 17090809665, 22898048404, 23339075780, 33564380939, 37517090594, 38587115133, 42519923294, 47489969603, 66776374486, 85751204605, 97571767596, 98954096617, 103466964513, 105410396815, 108719413993, 110747747703, 114712568823, 122975084397, 128938645449, 135064014126, 137417405566, 137527071596, 142672661935, 145176618414, 149504039139, 150155464780, 156195137948, 162912656308, 188599527912, 192691123424, 196101601537, 196889191957, 202704285017, 204635877880] indices     {"node_id": "abcde", "module": "nipostValidator", "module": "post::prove", "file": "src/prove.rs", "line": 323}\n2023-09-18T03:37:09.353-0400    INFO    abcde.post      proving: generated proof        {"node_id": "abcde", "module": "post"}                                                                                                                         2023-09-18T03:37:09.353-0400    INFO    abcde.atxBuilder        created the initial post        {"node_id": "abcde", "module": "atxBuilder"}\n2023-09-18T03:37:09.353-0400    INFO    abcde.atxBuilder        verifying the initial post      {"node_id": "abcde", "module": "atxBuilder", "post": {"nonce": 0, "indices": "6c93c00500d229fe7ee0806ce53a043dc4ea0f947dd454053182c75bb1f07c097d887cc5f0227da6f8fb8897a2987932dcf6e9b05873ba303efd8a2bf7134bc1eead95fefaa1708558725c608f02f38a58baa60b54765748919cdd8f9bd56a6ddfe2a15cf2e55581e7d21427f7f9d1dcfa7f6c934005e06b03fd4de85a36d31c8e638a3c8b4c90f6f522672a7d1749bb9de55ea2a7a1a5afe03449dd6c403e246a5b612a78dd66b577c8bcf8b13fa52f"}, "metadata": {"Challenge": "0000000000000000000000000000000000000000000000000000000000000000", "LabelsPerUnit": 4294967296}, "name": "atxBuilder"}\n2023-09-18T03:37:09.410-0400    ERROR   abcde.nipostValidator   Proof is invalid: MSB value for index: 137527071596 doesn\'t satisfy difficulty: 207 > 0 (label: [215, 101, 80, 15, 36, 236, 60, 243, 203, 157, 178, 129, 73, 177, 132, 65])       {"node_id": "abcde", "module": "nipostValidator", "module": "post::post_impl", "file": "ffi/src/post_impl.rs", "line": 242}                                                                                                                                                                                            2023-09-18T03:37:09.413-0400    FATAL   abcde.atxBuilder        initial POST proof is invalid. Probably the initialized POST data is corrupted. Please verify the data with postcli and regenerate the corrupted files.   {"node_id": "abcde", "module": "atxBuilder", "errmsg": "verify PoST: invalid proof", "name": "atxBuilder"}\n')),(0,n.yg)("p",null,"This message indicates that, despite the presence of a complete identity, the smeshing node was unable to generate a ",(0,n.yg)("a",{parentName:"p",href:"/docs/learn/post"},"PoST")," for a particular epoch due to corruption of the PoST data. The best way to verify this is to run ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/spacemeshos/post/tree/develop/cmd/postcli"},(0,n.yg)("inlineCode",{parentName:"a"},"postcli"))," in verify mode:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-console"},'> postcli -datadir /Volumes/post/7c8cef2b -fromFile 531 -verify -fraction 0.01\n2023/09/18 13:51:59 cli: verifying identity.key\n2023/09/18 13:51:59 cli: identity.key is valid\n2023/09/18 13:51:59 cli: verifying POS data\n2023-09-18T13:51:59.504-0400    INFO    verifying POS data in /Volumes/post/7c8cef2b  {"module": "post::pos_verification", "file": "src/pos_verification.rs", "line": 34}\n2023-09-18T13:51:59.504-0400    INFO    verifying POS files 531 -> 927  {"module": "post::pos_verification", "file": "src/pos_verification.rs", "line": 39}\n2023-09-18T13:51:59.504-0400    INFO    verifying file /Volumes/post/7c8cef2b/postdata_531.bin      {"module": "post::pos_verification", "file": "src/pos_verification.rs", "line": 43}\n2023-09-18T13:51:59.504-0400    INFO    verifying 26843 labels  {"module": "post::pos_verification", "file": "src/pos_verification.rs", "line": 66}\n2023-09-18T13:52:02.348-0400    INFO    POS data is invalid: invalid label in file 531 at offset 126368       {"module": "post::initialization", "file": "ffi/src/initialization.rs", "line": 242}\n2023/09/18 13:52:02 cli: invalid POS\n')),(0,n.yg)("p",null,"You can do this for an entire identity or only for a subset of files (using ",(0,n.yg)("inlineCode",{parentName:"p"},"-fromFile")," and ",(0,n.yg)("inlineCode",{parentName:"p"},"-toFile"),". See the\n",(0,n.yg)("a",{parentName:"p",href:"https://github.com/spacemeshos/post/tree/develop/cmd/postcli"},"README")," for more information). If nothing else is\nusing the drive (e.g., if the node is shut down and the drive is not being used for any other purpose), then running\n",(0,n.yg)("inlineCode",{parentName:"p"},"postcli verify")," with ",(0,n.yg)("inlineCode",{parentName:"p"},"-fraction 0.01")," should be quite quick. You can run the command with a larger fraction value for a more thorough\ncheck. "),(0,n.yg)("admonition",{type:"info"},(0,n.yg)("p",{parentName:"admonition"},"It is possible for multiple files to be corrupt. ",(0,n.yg)("inlineCode",{parentName:"p"},"postcli verify")," will quit itself after detecting a single corrupt file, and you can restart it with a higher ",(0,n.yg)("inlineCode",{parentName:"p"},"-fromFile")," to continue the process right after the corrupt file. Serious smeshers may wish to run such a verification process periodically to detect corruption issues before they lead to failures in proof generation and lost rewards.")),(0,n.yg)("p",null,"Once corrupt data is detected, the only option is to delete and regenerate the affected files. If the files are deleted and the node is restarted, it will automatically restart the PoST initialization process to fill in the missing data. This can also be done manually using ",(0,n.yg)("inlineCode",{parentName:"p"},"postcli"),"."),(0,n.yg)("h2",{id:"additional-troubleshooting"},"Additional Troubleshooting"),(0,n.yg)("h3",{id:"timesync-peers-are-not-time-synced"},(0,n.yg)("inlineCode",{parentName:"h3"},"timesync: peers are not time synced")),(0,n.yg)("p",null,"Please make sure that your system clock is synced with the internet. Please refer to time synchronization instructions\nfor your operating system."),(0,n.yg)("p",null,"If you're 100% certain that your system time is correct, you can disable the time sync check by setting the following config:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "time": {\n        "peersync": {\n            "disable": true\n        }\n    }\n}\n')),(0,n.yg)("h3",{id:"node-uses-too-much-memory"},"Node Uses Too Much Memory"),(0,n.yg)("p",null,"Please add a ",(0,n.yg)("inlineCode",{parentName:"p"},'"pprof-server": true')," to the config at the main level or add ",(0,n.yg)("inlineCode",{parentName:"p"},"--pprof-server")," to the command line. Restart the node and then visit ",(0,n.yg)("a",{parentName:"p",href:"http://127.0.0.1:6060/debug/pprof/profile?seconds=30"},"http://127.0.0.1:6060/debug/pprof/profile?seconds=30")," and\n",(0,n.yg)("a",{parentName:"p",href:"http://127.0.0.1:6060/debug/pprof/heap"},"http://127.0.0.1:6060/debug/pprof/heap")," in your default browser and download the files. Please share then these files on Discord or in a GitHub issue. Advanced users can use ",(0,n.yg)("inlineCode",{parentName:"p"},"go tool pprof http://localhost:6060/debug/pprof/heap")," to see what is using the memory."))}u.isMDXComponent=!0}}]);