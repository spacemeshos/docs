"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[336],{5680:(e,n,t)=>{t.d(n,{xA:()=>g,yg:()=>c});var i=t(6540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=i.createContext({}),p=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},g=function(e){var n=p(e.components);return i.createElement(l.Provider,{value:n},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,g=s(e,["components","mdxType","originalType","parentName"]),d=p(t),u=r,c=d["".concat(l,".").concat(u)]||d[u]||m[u]||o;return t?i.createElement(c,a(a({ref:n},g),{},{components:t})):i.createElement(c,a({ref:n},g))}));function c(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,a=new Array(o);a[0]=u;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[d]="string"==typeof e?e:r,a[1]=s;for(var p=2;p<o;p++)a[p]=t[p];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},7387:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var i=t(8168),r=(t(6540),t(5680));const o={id:"performance",title:"Fine-Tuning Node Performance"},a=void 0,s={unversionedId:"start/smeshing/smeshing_adv/performance",id:"start/smeshing/smeshing_adv/performance",title:"Fine-Tuning Node Performance",description:"Besides performance optimizations while running a public-private node setup, there are a few other settings that can be used to fine-tune the performance of a node. Please note that these are not directly related to the proving performance but they may impact it depending on the system, setup, hardware, etc.",source:"@site/docs/start/smeshing/smeshing_adv/performance.md",sourceDirName:"start/smeshing/smeshing_adv",slug:"/start/smeshing/smeshing_adv/performance",permalink:"/docs/start/smeshing/smeshing_adv/performance",draft:!1,editUrl:"https://github.com/spacemeshos/docs/edit/main/docs/start/smeshing/smeshing_adv/performance.md",tags:[],version:"current",frontMatter:{id:"performance",title:"Fine-Tuning Node Performance"},sidebar:"start",previous:{title:"Networking",permalink:"/docs/start/smeshing/smeshing_adv/networking"},next:{title:"Avoiding Equivocation",permalink:"/docs/start/smeshing/smeshing_adv/equivocation"}},l={},p=[{value:"Distributed Verification",id:"distributed-verification",level:3},{value:"Verifying Workers",id:"verifying-workers",level:3},{value:"RandomX Fast Mode",id:"randomx-fast-mode",level:3},{value:"Performance Optimizations While Running Public-Private Node Setup",id:"performance-optimizations-while-running-public-private-node-setup",level:4},{value:"Disabling Verifying PoST on Private Nodes",id:"disabling-verifying-post-on-private-nodes",level:5},{value:"Changing k3 Parameter",id:"changing-k3-parameter",level:5},{value:"RandomX Fast mode",id:"randomx-fast-mode-1",level:5}],g={toc:p},d="wrapper";function m(e){let{components:n,...t}=e;return(0,r.yg)(d,(0,i.A)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Besides ",(0,r.yg)("a",{parentName:"p",href:"/docs/start/smeshing/smeshing_adv/performance#performance-optimizations-while-running-public-private-node-setup"},"performance optimizations while running a public-private node setup"),", there are a few other settings that can be used to fine-tune the performance of a node. Please note that these are not directly related to the proving performance but they ",(0,r.yg)("em",{parentName:"p"},"may")," impact it depending on the system, setup, hardware, etc."),(0,r.yg)("h3",{id:"distributed-verification"},"Distributed Verification"),(0,r.yg)("p",null,"Starting with go-spacemesh version 1.4.4, it is safe to use distributed verification."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'"post": { "post-k3": 1 }\n')),(0,r.yg)("p",null,"This configuration allows your node to only verify a subset of labels (",(0,r.yg)("inlineCode",{parentName:"p"},"1")," in the example) and rely on other nodes to validate the remaining ones. Because different nodes will pick up different subsets of labels with the requested size, it is also safe to enable this on public nodes to limit the CPU resources needed."),(0,r.yg)("h3",{id:"verifying-workers"},"Verifying Workers"),(0,r.yg)("p",null,"Whenever your node gets a new ATX, it needs to validate the ATX using verifying workers. By default, half of the CPU cores are assigned as workers that validate the ATXs. You can set the number of workers by editing the following config:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'"smeshing":\n  {\n    "smeshing-verifying-opts":\n      {\n        "smeshing-opts-verifying-min-workers": 1,\n        "smeshing-opts-verifying-workers": 12,\n      },\n  }\n')),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"smeshing-opts-verifying-min-workers")," defines the minimal number of workers. The node will automatically scale down to that number WHEN it is proving. When the node is not proving, it will use up to ",(0,r.yg)("inlineCode",{parentName:"p"},"smeshing-opts-verifying-workers")," workers."),(0,r.yg)("p",null,"In order to minimize system impact, ",(0,r.yg)("inlineCode",{parentName:"p"},"smeshing-opts-verifying-min-workers")," can be configured to ",(0,r.yg)("inlineCode",{parentName:"p"},"1")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"smeshing-opts-verifying-workers")," can also be set to ",(0,r.yg)("inlineCode",{parentName:"p"},"1"),". While these settings ensure the lowest strain on system resources, it is important to note that they will result in slower ATX verification, consequently affecting the synchronization speed. For those actively smeshing on the node, it is advisable to set the ",(0,r.yg)("inlineCode",{parentName:"p"},"smeshing-opts-verifying-workers")," to the same value as ",(0,r.yg)("inlineCode",{parentName:"p"},"smeshing-opts-proving-workers"),". This configuration is optimal for reducing the potential negative performance impact on smeshing for other nodes, particularly if the given node has already completed its PoST."),(0,r.yg)("h3",{id:"randomx-fast-mode"},"RandomX Fast Mode"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'"smeshing":\n  { "smeshing-verifying-opts": { "smeshing-opts-verifying-powflags": 14 } }\n')),(0,r.yg)("p",null,"You can manually set the RadomX mode as well. RandomX is also used with every incoming ATX. Setting it to ",(0,r.yg)("inlineCode",{parentName:"p"},"14")," from the default ",(0,r.yg)("inlineCode",{parentName:"p"},"10")," makes it significantly  faster but at the expense of 2 GiB extra RAM used. In most setups, that is not needed, but it is safe to use if you have spare RAM."),(0,r.yg)("h4",{id:"performance-optimizations-while-running-public-private-node-setup"},"Performance Optimizations While Running Public-Private Node Setup"),(0,r.yg)("p",null,"If you are running a public-private node setup, you may wish to tweak the following settings to improve the CPU resource usage of your ",(0,r.yg)("strong",{parentName:"p"},"private")," nodes."),(0,r.yg)("h5",{id:"disabling-verifying-post-on-private-nodes"},"Disabling Verifying PoST on Private Nodes"),(0,r.yg)("p",null,"Verification of PoSTs in the ATX that come from the network is significantly hard work for the CPU. In a setup where only some nodes are public, it makes no sense to repeat this work on the private nodes if they can trust the public nodes to do the work honestly."),(0,r.yg)("p",null,"PoST verification can be disabled completely on selected nodes by using ",(0,r.yg)("inlineCode",{parentName:"p"},"--smeshing-opts-verifying-disable")," CLI flag or by making the following config entry:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "smeshing": {\n    "smeshing-verifying-opts": {\n      "smeshing-opts-verifying-disable": true\n    }\n}\n')),(0,r.yg)("p",null,":::warning"),(0,r.yg)("p",null,"Disabling PoST verification is ",(0,r.yg)("strong",{parentName:"p"},"only safe on the private")," nodes because the ",(0,r.yg)("strong",{parentName:"p"},"public")," node will verify ATXs sent to it. Given that the private nodes are only connected to public nodes, there is no risk involved here. It is strongly ",(0,r.yg)("strong",{parentName:"p"},"discouraged")," to use this setting on ",(0,r.yg)("strong",{parentName:"p"},"public")," nodes."),(0,r.yg)("p",null,":::"),(0,r.yg)("h5",{id:"changing-k3-parameter"},"Changing k3 Parameter"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'"post": { "post-k3": 0 }\n')),(0,r.yg)("p",null,"Setting the ",(0,r.yg)("inlineCode",{parentName:"p"},"k3")," parameter to 0 will significantly lower the CPU requirements while verifying the incoming ATXs. By default, the ",(0,r.yg)("inlineCode",{parentName:"p"},"k3")," parameter is equal to ",(0,r.yg)("inlineCode",{parentName:"p"},"k2")," which is currently 37. Setting it to a value lower than 37 will check fewer labels in the proofs and therefore speed up the checks. The downside is that it will lower the security of the ATX verification. The lower the value, the lower the security. Setting it to 0 will completely disable the verification of proof labels. The node will still verify the k2pow with RandomX though."),(0,r.yg)("p",null,":::warning "),(0,r.yg)("p",null,"Setting k3 to 0 is safe to use on ",(0,r.yg)("strong",{parentName:"p"},"only on the private")," nodes because the ",(0,r.yg)("strong",{parentName:"p"},"public")," node will verify whole proofs and not just one label as set in the config above. And given that the private nodes are only connected to public nodes then there is no risk involved here. It is strongly ",(0,r.yg)("strong",{parentName:"p"},"discouraged")," to use this setting on ",(0,r.yg)("strong",{parentName:"p"},"public")," nodes."),(0,r.yg)("p",null,":::"),(0,r.yg)("h5",{id:"randomx-fast-mode-1"},"RandomX Fast mode"),(0,r.yg)("p",null,"To improve ATX verification speed on ",(0,r.yg)("strong",{parentName:"p"},"public")," nodes you can use the following setting. It will roughly require an additional 2 GiB of RAM per node that is only used during ATX verification."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'"smeshing":\n  { "smeshing-verifying-opts": { "smeshing-opts-verifying-powflags": 14 } }\n')),(0,r.yg)("p",null,"If you have spare RAM on the private nodes then this setting is safe to set there too. However, please remember about the requirement of ",(0,r.yg)("strong",{parentName:"p"},"2 GiB extra memory")," per node."))}m.isMDXComponent=!0}}]);